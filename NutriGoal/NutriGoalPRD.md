# Product Requirements Document (PRD)

## üìÑ App Name: **NutriGoal**

## üöÄ Purpose

NutriGoal is an iOS-only AI-powered nutrition and lifestyle tracker designed to help users not only log food and activity but also reflect on their habits and progress through:

* AI-generated daily journals
* Chat-based AI motivation and habit coaching
* Personalized lifestyle scoring (0‚Äì10)
* Range-based calorie & macro goals
* Deep integration with Apple Health for sleep, steps, and workouts

NutriGoal offers a more emotionally supportive and intelligent alternative to traditional calorie trackers by combining data with daily coaching and habit reinforcement.

---

## üß† Target Platform

* iOS 17+ (iPhone only)
* Future Apple Watch support (phase 2)

---

## ‚öñÔ∏è Pricing Model

**Paid-only model**:

* \$9.99/month
* \$59.99/year

Managed via **RevenueCat** for subscriptions.

---

## üåê Tech Stack

### Frontend:

* **SwiftUI** (UI layer)
* **Combine / Swift Concurrency** (state + reactive logic)
* **MVVM Clean Architecture**

### Backend & Services:

* **Firebase Authentication** (email, Google, Facebook, Apple Sign-In)
* **Firebase Firestore** (user data, journal entries, meal logs)
* **Firebase Cloud Functions** (optional business logic scaling)
* **RevenueCat** (IAP subscription management)

### External APIs:

* **OpenAI GPT-4o** (AI journaling, chat-based coaching, and food recognition)
* **Open Food Facts / USDA API** (barcode scanning + nutrition DB)
* **HealthKit** (steps, sleep, active energy, workouts)

---

## üåü Features

### Core Features:

* Personalized onboarding to determine calorie/macro **ranges**, goals, and journal tone
* AI-generated **daily journal** reflecting on food, sleep, activity, mood
* **Chat-based AI coach** for real-time motivation, emotional support, habit advice
* **Lifestyle score** (0‚Äì10) calculated using:

  * Calorie adherence (to range)
  * Protein, fat, carb balance
  * Steps/activity
  * Water intake
  * Sleep duration
  * Bedtime consistency
* **Food logging**:

  * Manual entry
  * Barcode scanner
  * AI photo recognition (GPT-4o or CalorieMama)
* **Apple Health Integration**:

  * Read steps, workouts, sleep, calories burned
  * Optional read heart rate, body weight
* **User Authentication**:

  * Email/password
  * Google, Facebook, Apple login (via Firebase)

---

## üìÜ App Flow Overview

1. **Splash & Onboarding**

   * Welcome screen
   * Collect basic info (age, weight, height, goal)
   * Set goal type (lose, maintain, gain)
   * Set activity level
   * Bedtime & sleep questions
   * Determine tone (supportive / motivational / analytical)
   * Generate personalized calorie/macro range

2. **Home Dashboard**

   * Summary of today's:

     * Score (0‚Äì10)
     * Meals (logged/macros)
     * Steps/sleep/activity
   * "Write Journal" button (auto-triggered every night)
   * "Chat with Coach" button for real-time AI conversation

3. **Food Logging**

   * Manual search
   * Barcode scan
   * Snap photo of food
   * Auto-fill calorie/macros (editable)

4. **Daily Journal**

   * Generated by AI
   * Feedback on food, activity, sleep, score
   * Positive reinforcement + micro-coaching

5. **AI Chat Coach**

   * Chat-based interface with GPT-4o
   * Personalized to user goals, tone, and recent habits
   * Offers:

     * Motivation
     * Habit-building advice
     * Emotional support
     * Encouragement during setbacks

6. **Profile & History**

   * Trends of scores, weight (optional), nutrition
   * Update profile & preferences

---

## üìä Architecture: MVVM Clean (modular, scalable)

### Layers:

**1. Presentation (SwiftUI)**

* Views: UI pages
* ViewModels: Connect views with use cases, manage state
* UI Models: Structs for view rendering

**2. Domain**

* UseCases: Business logic (e.g., CalculateScore, GenerateJournal, ChatWithCoach)
* Entities: Core data types (User, Meal, Score, JournalEntry)
* Interfaces: Repository protocols

**3. Data**

* Services: Firebase, OpenAI, HealthKit integrations
* Repository Implementations: Firestore, API clients
* Mappers: Convert between API and domain models

---

## üß† AI Journaling & Coaching Structure (GPT-4o)

### A. Journal Generation Prompt

```plaintext
User profile:
- Goal: [Lose weight / Maintain / Gain muscle]
- Tone: [Supportive / Motivational / Analytical]
- Daily calorie range: [1,800‚Äì2,000 kcal]

Today's data:
- Calories consumed: 1,920 kcal
- Protein: 130g | Carb: 190g | Fat: 60g
- Steps: 8,100
- Workout: 30 minutes cardio
- Sleep: 7h 15m | Bedtime: 11:45 PM
- Water: 2.1L
- Mood: ‚ÄúA little tired but proud.‚Äù

Write a short, encouraging journal entry based on the data above. Include praise, habit reflection, and gentle suggestions.
```

### B. Chat Coaching Prompt

```plaintext
Act as a daily wellness and motivation coach. The user is on a journey to [Lose Weight / Gain Muscle / Maintain Health] and prefers a [supportive / motivational / analytical] tone.

Use their data and goals to give personalized replies to their messages. Be emotionally intelligent, empathetic, and concise. Always aim to motivate or offer small, actionable steps. Do not be robotic.

User Data:
- Last score: 7.9
- Mood: ‚ÄúFeeling low today.‚Äù
- Skipped workout
- Over calorie target

User Message: ‚ÄúI feel like I failed today. I had fast food and skipped my walk.‚Äù
```

**Expected GPT-4o Output**:

> ‚ÄúYou didn‚Äôt fail. One day doesn‚Äôt erase all your progress. What matters is how you respond tomorrow. Can you go for a short 10-minute walk tonight just to reset your momentum? That small step can shift your entire mindset.‚Äù

---

## üßæ Firebase Schema Design (Firestore)

### `/users/{uid}`

```json
{
  "email": "user@example.com",
  "goal": "LoseWeight",
  "tone": "supportive",
  "height_cm": 175,
  "weight_kg": 77,
  "target_weight_kg": 70,
  "activity_level": "moderate",
  "bedtime": "23:30",
  "sleep_hours": 7,
  "created_at": Timestamp,
  "subscription_status": "active"
}
```

### `/journal_entries/{uid}/{date}`

```json
{
  "date": "2025-06-08",
  "score": 8.6,
  "entry_text": "AI journal text here...",
  "calories": 1920,
  "protein_g": 130,
  "carbs_g": 190,
  "fat_g": 60,
  "steps": 8100,
  "workout_minutes": 30,
  "sleep_hours": 7.15,
  "bedtime": "23:45",
  "water_liters": 2.1,
  "mood": "A little tired but proud."
}
```

### `/meals/{uid}/{date}/{meal_id}`

```json
{
  "name": "Grilled chicken with rice",
  "photo_url": "https://...",
  "calories": 520,
  "protein_g": 45,
  "carbs_g": 50,
  "fat_g": 15,
  "timestamp": Timestamp
}
```

---

## üõ° Security & Scalability Best Practices

### üîê Security:

* Use **Apple's Sign in with Apple** to comply with App Store rules
* Store sensitive data (tokens, preferences) securely in **Keychain**
* Firestore rules:

  * Restrict access per user UID
  * Enforce least-privilege data access
* Use **HTTPS-only** endpoints
* Sanitize and validate all user inputs before sending to GPT or Firestore

### üìà Scalability:

* Use **modular clean architecture** for feature scaling
* Load nutrition data via **pagination/lazy loading**
* **Offline-first** Firestore sync for meal logs
* Batch writes to Firestore to reduce read/write costs
* Use **Cloud Functions** (optional) to handle future AI caching, heavy processing
* Optimize HealthKit queries to run in background (non-blocking)

---

## üßë‚Äçüíª Next Steps for Dev Team (Cursor or Solo Dev)

1. Implement folder structure (see MVVM layout in companion doc)
2. Set up Firebase + RevenueCat
3. Implement onboarding logic
4. Build food logging & journaling logic
5. Build AI chat coach interface + prompt logic
6. Implement HealthKit sync
7. Test full AI pipeline (GPT image, journaling, chat)
8. Deploy to TestFlight for closed beta

---

Let me know if you want this turned into a Notion doc, PDF, or delivered as a handoff pack with sample code modules and diagrams!

